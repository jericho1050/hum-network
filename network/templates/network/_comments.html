{% load humanize %}

<div class="comment-section" id="comment-section-{{ post.id }}">
  {% if comments %}
    <div class="comment-list">
      {% for comment in comments %}
        <div class="comment-item" id="comment-{{ comment.id }}">
          <div class="d-flex">
            <div class="me-2">
              {% if comment.comment_by.profile_picture %}
                <a href="{% url 'profile' comment.comment_by.id %}">
                  <img src="{{ comment.comment_by.profile_picture.url }}" class="rounded-circle" width="24" height="24" alt="Profile picture">
                </a>
              {% else %}
                <a href="{% url 'profile' comment.comment_by.id %}">
                  <img src="{{ MEDIA_URL }}no-picture.jpg" class="rounded-circle" width="24" height="24" alt="Profile picture">
                </a>
              {% endif %}
            </div>
            <div>
              <div>
                <a href="{% url 'profile' comment.comment_by.id %}" class="fw-bold text-decoration-none">{{ comment.comment_by.username }}</a>
                <span class="text-muted">{{ comment.timestamp|naturaltime }}</span>
              </div>
              <p class="mb-1">{{ comment.comment }}</p>
            </div>
            {% if user == comment.comment_by %}
            <div class="ms-auto">
              <button class="btn btn-sm like-btn text-danger" 
                      hx-delete="{% url 'delete_comment' comment.id %}" 
                      hx-target="#comment-{{ comment.id }}" 
                      hx-swap="outerHTML"
                      hx-confirm="Delete this comment?">
                <i class="bi bi-trash"></i>
              </button>
            </div>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
  
  {% if user.is_authenticated %}
    <div class="comment-form mt-3">
      <form hx-post="{% url 'add_comment' post.id %}"
            hx-target="#comment-section-{{ post.id }}"
            hx-swap="outerHTML"
            class="d-flex align-items-center">
        {% csrf_token %}
        <div class="me-2">
          {% if user.profile_picture %}
            <img src="{{ user.profile_picture.url }}" class="rounded-circle" width="32" height="32" alt="Your profile picture">
          {% else %}
            <img src="{{ MEDIA_URL }}no-picture.jpg" class="rounded-circle" width="32" height="32" alt="Your profile picture">
          {% endif %}
        </div>
        <div class="flex-grow-1 me-2">
          <textarea name="comment" rows="4" class="form-control" placeholder="Add a comment..." required></textarea>
        </div>
        <button type="submit" class="btn btn-sm like-btn text-primary fw-bold" id="comment-submit-{{ post.id }}">
          <span class="d-none d-md-inline">Comment</span>
          <i class="bi bi-send"></i>
        </button>
      </form>
    </div>
  {% endif %}
</div> 